; Simple test program for Palindrome VM
; Tests RISA (Reversible Instruction Set Architecture) with SDM

main:
    ; Create checkpoint - SDM will version pages automatically
    CHECKPOINT beginning
    
    ; Initialize registers using LoadImm (LI alias)
    LI R0, 10
    LI R1, 20
    LI R2, 0
    LI R3, 0
    
    ; Perform reversible arithmetic
    RADD R0, R1, R2    ; R2 = R2 + R0 + R1 = 0 + 10 + 20 = 30
    LI R4, 10
    LI R5, 0
    RADD R2, R4, R3    ; R3 = R3 + R2 + R4 = 0 + 30 + 10 = 40
    
    ; Test reversible XOR
    LI R6, 0xFF
    RXOR R6, R0        ; R0 = R0 XOR R6 = 10 XOR 0xFF = 0xF5
    RXOR R6, R0        ; R0 = R0 XOR R6 = 0xF5 XOR 0xFF = 10 (restored)
    
    ; Test SWAP operation
    SWAP R2, R3        ; R2 = 40, R3 = 30
    SWAP R2, R3        ; R2 = 30, R3 = 40 (restored)
    
    ; Test tape operations with SDM
    TAPEWRITE R3, 8    ; Write 40 to tape at position 0
    TAPESEEK 0         ; Go back to position 0
    TAPEREAD R7, 8     ; Read it back into R7
    
    ; Test comparison
    COMPARE R6, R7, R3 ; Compare R7 (40) with R3 (40)
    DEBUG Comparison result (should be 0 for equal)
    
    ; Demonstrate reversibility
    RSUB R2, R4, R3    ; R3 = R3 - R2 - R4 = 40 - 30 - 10 = 0
    RSUB R0, R1, R2    ; R2 = R2 - R0 - R1 = 30 - 10 - 20 = 0
    
    DEBUG All tests complete - values reversed to original
    
    ; Uncomment to test time-travel with SDM:
    ; REWIND beginning
    
    HALT